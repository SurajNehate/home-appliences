<form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="form">
  <div class="row">
    <mat-form-field appearance="outline" class="field">
      <mat-label>Name</mat-label>
      <input matInput formControlName="name" required>
      <mat-error *ngIf="productForm.get('name')?.hasError('required') && productForm.get('name')?.touched">Name is required</mat-error>
      <mat-error *ngIf="productForm.get('name')?.hasError('minlength') && productForm.get('name')?.touched">Minimum 3 characters</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="field">
      <mat-label>Price</mat-label>
      <input matInput type="number" formControlName="price" required>
      <mat-error *ngIf="productForm.get('price')?.hasError('required') && productForm.get('price')?.touched">Price is required</mat-error>
      <mat-error *ngIf="productForm.get('price')?.hasError('min') && productForm.get('price')?.touched">Must be a positive number</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline" class="field">
      <mat-label>Category</mat-label>
      <mat-select formControlName="category" required>
        <mat-option *ngFor="let c of categories" [value]="c">{{ c }}</mat-option>
      </mat-select>
      <mat-error *ngIf="productForm.get('category')?.hasError('required') && productForm.get('category')?.touched">Category is required</mat-error>
    </mat-form-field>
  </div>

  <mat-form-field appearance="outline" class="field full">
    <mat-label>Description</mat-label>
    <textarea matInput rows="4" formControlName="description"></textarea>
    <mat-error *ngIf="productForm.get('description')?.hasError('required') && productForm.get('description')?.touched">Description is required</mat-error>
    <mat-error *ngIf="productForm.get('description')?.hasError('minlength') && productForm.get('description')?.touched">Minimum 10 characters</mat-error>
  </mat-form-field>

  <mat-slide-toggle formControlName="status">Active</mat-slide-toggle>

  <div class="images">
    <div class="picker">
      <button mat-stroked-button type="button" (click)="mainImage.click()">
        <span class="material-symbols-outlined">image</span>&nbsp;Main Image
      </button>
      <input #mainImage type="file" accept="image/*" (change)="onMainImageSelected($event)" hidden>
    </div>
    <div class="preview" *ngIf="mainImagePreview">
      <img [src]="mainImagePreview" alt="Main preview">
    </div>
  </div>

  <div class="images">
    <div class="picker">
      <button mat-stroked-button type="button" (click)="additional.click()">
        <span class="material-symbols-outlined">collections</span>&nbsp;Additional Images
      </button>
      <input #additional type="file" accept="image/*" multiple (change)="onAdditionalImagesSelected($event)" hidden>
    </div>
    <div class="preview-list">
      <img *ngFor="let img of additionalImagePreviews; let i = index" [src]="img" alt="Additional preview"
           (click)="removeAdditionalImage(i)" title="Click to remove"/>
    </div>
  </div>

  <div class="actions">
    <button mat-flat-button color="primary" type="submit" [disabled]="isLoading || productForm.invalid">
      <span class="material-symbols-outlined">save</span>&nbsp;
      {{ product?.id ? 'Update' : 'Create' }}
    </button>
    <a mat-button color="warn" [routerLink]="['/products']" (click)="onCancel()">
      <span class="material-symbols-outlined">close</span>&nbsp;Cancel
    </a>
  </div>
</form>
