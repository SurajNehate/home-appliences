<section class="section-lg container">
  <div class="home-header">
    <div>
      <h1 class="h1">Havenza Collection</h1>
      <p class="h2">Discover our curated selection of modern home decor items to transform your living space.</p>
    </div>
  </div>
</section>

<section class="section container" *ngIf="categories$ | async as categories">
  <div class="controls rounded shadow-sm">
    <mat-form-field class="search" appearance="outline">
      <span matPrefix class="material-symbols-outlined">search</span>
      <input #searchInput matInput placeholder="Search products..." [formControl]="fcSearch" />
      <button mat-icon-button matSuffix class="clear-btn" *ngIf="fcSearch.value" (click)="clearSearch($event)" aria-label="Clear search">
        <span class="material-symbols-outlined">close</span>
      </button>
    </mat-form-field>

    <mat-form-field class="category dense" appearance="outline">
      <mat-select [formControl]="fcCategory" placeholder="Category">
        <mat-option value="all">All</mat-option>
        <mat-option *ngFor="let c of categories" [value]="c">{{ c }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</section>

<section class="section container">
  <div class="grid" role="list" *ngIf="filtered$ | async as products">
    <mat-card class="card transition-base" role="listitem" *ngFor="let p of products; trackBy: trackById" (click)="goTo(p)" tabindex="0" (keydown.enter)="goTo(p)">
      <div class="media">
        <img mat-card-image [src]="p.imageUrl || 'https://picsum.photos/seed/' + p.id + '/600/400'" [alt]="p.name" loading="lazy" />
        <span class="badge" *ngIf="p.category">{{ p.category }}</span>
      </div>
      <mat-card-header>
        <mat-card-title>{{ p.name }}</mat-card-title>
        <mat-card-subtitle class="text-muted">{{ p.category }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p class="price">â‚¹ {{ p.price | number:'1.0-2' }}</p>
      </mat-card-content>
      <mat-card-actions class="card-actions">
        <button mat-flat-button class="add-to-cart-btn" (click)="add(p); $event.stopPropagation()" [attr.aria-label]="'Add ' + p.name + ' to cart'">
          <span class="material-symbols-outlined">shopping_cart</span>
          Add to Cart
        </button>
        <button *ngIf="auth.isAdmin()" mat-icon-button class="edit-btn" (click)="editProduct(p, $event)" [attr.aria-label]="'Edit ' + p.name">
          <span class="material-symbols-outlined">edit</span>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</section>

<ng-template #loadingTpl>
  <div class="container section">
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
</ng-template>

<div class="actions" *ngIf="auth.isAdmin()">
  <a mat-fab color="accent" [routerLink]="['/products/add']" aria-label="Add product">
    <span class="material-symbols-outlined">add</span>
  </a>
</div>
