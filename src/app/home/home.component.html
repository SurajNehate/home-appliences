<div class="mt-3">
  <div class="d-md-none px-2 mb-2 d-flex align-items-center">
    <button mat-stroked-button color="primary" (click)="toggleSidenav()">
      <mat-icon>menu</mat-icon>
      Categories
    </button>
  </div>

  <mat-sidenav-container class="home-sidenav-container">
    <mat-sidenav [mode]="isHandset ? 'over' : 'side'" [opened]="isHandset ? sidenavOpened : true" fixedInViewport="false" class="home-sidenav">
      <div class="p-2">
        <h6 class="mb-2">Categories</h6>
        <mat-nav-list>
          <a mat-list-item (click)="goToCategory('All')" [class.active]="activeCategory==='All'">All</a>
          <a mat-list-item *ngFor="let c of categories" (click)="goToCategory(c)" [class.active]="activeCategory===c">{{ c }}</a>
          <div class="text-muted p-2" *ngIf="categories.length === 0">No categories yet</div>
        </mat-nav-list>
        <mat-divider class="my-2"></mat-divider>
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Search products</mat-label>
          <input matInput [(ngModel)]="searchTerm">
          <button mat-icon-button matSuffix *ngIf="searchTerm" (click)="searchTerm=''" aria-label="Clear">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </mat-sidenav>

    <mat-sidenav-content>
      <div class="container-fluid">
        <h3 class="mt-2 mb-3" *ngIf="activeCategory === 'All'">Featured</h3>
        <div class="row" *ngIf="activeCategory === 'All'">
          <div class="col-sm-6 col-lg-4 mb-4" *ngFor="let p of featured">
            <mat-card class="product-card h-100 sim-pointer" matRipple (click)="viewProduct(p.id)">
              <img mat-card-image [src]="p.imageUrl" [alt]="p.name">
              <mat-card-content>
                <h5 class="mb-1 text-truncate" title="{{p.name}}">{{ p.name }}</h5>
                <p class="small text-muted">{{ p.description }}</p>
              </mat-card-content>
              <mat-card-actions>
                <span class="price">₹ {{ p.price }}</span>
              </mat-card-actions>
            </mat-card>
          </div>
        </div>

        <h3 id="home-products" class="mt-4 mb-3">{{ activeCategory === 'All' ? 'All Products' : activeCategory }}</h3>
        <div class="row">
          <div class="col-sm-6 col-lg-4 mb-4" *ngFor="let p of filtered()">
            <mat-card class="product-card h-100 sim-pointer" matRipple (click)="viewProduct(p.id)">
              <img mat-card-image [src]="p.imageUrl" [alt]="p.name">
              <mat-card-content>
                <h5 class="mb-1 text-truncate" title="{{p.name}}">{{ p.name }}</h5>
                <p class="small text-muted">{{ p.description }}</p>
              </mat-card-content>
              <mat-card-actions>
                <span class="price">₹ {{ p.price }}</span>
              </mat-card-actions>
            </mat-card>
          </div>
          <div class="col-12" *ngIf="filtered().length === 0">
            <div class="alert alert-light border">No products in this category.</div>
          </div>
        </div>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
