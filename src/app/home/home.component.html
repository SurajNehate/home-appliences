<div class="mt-3">
  <div class="container-fluid">
    <!-- Unified top filter bar: categories dropdown on left, search on right -->
    <div class="filter-bar d-flex flex-column flex-md-row align-items-stretch align-items-md-center justify-content-between">
      <div class="d-flex align-items-center">
        <mat-form-field appearance="fill" class="mr-0 mr-md-3 mb-2 mb-md-0 cat-field">
          <mat-label>Category</mat-label>
          <mat-select [(ngModel)]="activeCategory">
            <mat-option value="All">All</mat-option>
            <mat-option *ngFor="let c of categories" [value]="c">{{ c }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search products</mat-label>
        <input matInput [(ngModel)]="searchTerm" placeholder="Search products...">
        <button mat-icon-button matSuffix *ngIf="searchTerm" (click)="searchTerm=''" aria-label="Clear">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <h3 id="home-products" class="mt-3 mb-3">{{ activeCategory === 'All' ? 'All Products' : activeCategory }}</h3>

    <div class="row">
      <div class="col-sm-6 col-lg-4 mb-4" *ngFor="let p of filtered()">
        <mat-card class="product-card h-100 sim-pointer" matRipple (click)="viewProduct(p.id)">
          <img mat-card-image [src]="p.imageUrl" [alt]="p.name">
          <mat-card-content>
            <h5 class="mb-1 text-truncate" title="{{p.name}}">{{ p.name }}</h5>
            <p class="small text-muted">{{ p.description }}</p>
          </mat-card-content>
          <mat-card-actions>
            <span class="price">â‚¹ {{ p.price }}</span>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="col-12" *ngIf="filtered().length === 0">
        <div class="alert alert-light border">No products in this category.</div>
      </div>
    </div>
  </div>
</div>
